<script src='/socket.io/socket.io.js'></script>
<script>
    var webconfig = './config/webconfig.json';
    var request = new XMLHttpRequest();
    request.open('GET',webconfig);
    request.responseType = 'json';
    request.send();
    var socket;
    request.onload = function(){
        var config = request.response;
        socket = io.connect(config.address+':'+config.port);
        socket.on('replaydata',(datas)=>{
            let splitdata = datas.split('\n');
            let list = [];
            splitdata.forEach(element => {
                if(element !== ''){
                    let splitElement = element.split(' ');
                    if(splitElement[1].slice(0,1) === 'M'){
                        list.push(splitElement);
                    }else if(splitElement[1].slice(0,1) === 'Q'){
                        list.push(splitElement);
                    }else if(splitElement[1].slice(0,1) === 'L'){
                        list.push(splitElement);
                        // console.log(list);
                        // list = [];
                        makeReplayData(list);
                        list=[];
                    }
                    // console.log(splitElement);
                    // makeReplayData(splitElement);
                }
            });
        });
    }
    function send(dist,obj,oCoords,pageNum,ident,text,time){
        if(dist == 'object'){
            console.log(text);
            socket.emit(dist,getUserName(),obj,oCoords,pageNum,ident,text,getPdfName(),time);
        }else if(dist == 'userName'){
            console.log(oCoords);
            socket.emit(dist,obj,oCoords);
        }else{
            socket.emit(dist,obj);
        }
    }

    function removeObject(obj,oCoords,pageNum,text,ident,time){
        console.log(text);
        socket.emit('remove',getUserName(),obj,oCoords,pageNum,text,ident,getPdfName(),time);
    }

    window.addEventListener('beforeunload',function(e){
        socket.emit('reload',getUserName());
        socket.emit('clear',getUserName(),pageNum);
    })

    function clearObject(pageNum){
        socket.emit('clear',getUserName(),pageNum);
    }

    function getData(){
        socket.emit('getdata',getUserName());
    }

</script>